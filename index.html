<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>District Police Range Kathmandu - Contact Directory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card-hover {
            transition: all 0.2s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .search-highlight {
            background-color: #fef08a;
            padding: 0 2px;
            border-radius: 2px;
        }
        .sort-icon {
            transition: transform 0.2s;
        }
        .sort-asc .sort-icon {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-900 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <img src="https://www.nepalpolice.gov.np/images/logo.png" alt="Nepal Police Logo" class="h-16 mr-4">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold">District Police Range Kathmandu</h1>
                        <p class="text-blue-200">Contact Directory</p>
                    </div>
                </div>
                <div class="relative w-full md:w-64">
                    <input type="text" id="globalSearch" placeholder="Search contacts..." 
                           class="w-full px-4 py-2 rounded-full text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button class="absolute right-3 top-2 text-gray-500">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Tabs Navigation -->
        <div class="flex flex-wrap border-b border-gray-200 mb-8">
            <button id="floorsTab" class="tab-button active px-6 py-3 font-medium text-blue-700 border-b-2 border-blue-700 bg-gray-100 outline outline-1 outline-blue-700">Floors & Sections</button>
            <button id="subOfficesTab" class="tab-button px-6 py-3 font-medium text-gray-600 hover:text-blue-700 bg-gray-100 outline outline-1 outline-blue-700">Subordinate Offices</button>
            <button id="otherOfficesTab" class="tab-button px-6 py-3 font-medium text-gray-600 hover:text-blue-700 bg-gray-100 outline outline-1 outline-blue-700">Other Offices</button>
            <button id="allContactsTab" class="tab-button px-6 py-3 font-medium text-gray-600 hover:text-blue-700 bg-gray-100 outline outline-1 outline-blue-700">All Contacts</button>
        </div>

        <!-- Tab Contents -->
        <div class="tab-content">
            <!-- Floors & Sections Content -->
            <div id="floorsContent" class="tab-pane active fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="floorsContainer">
                    <!-- Floors will be loaded here dynamically -->
                </div>
            </div>

            <!-- Subordinate Offices Content -->
            <div id="subOfficesContent" class="tab-pane hidden fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="subOfficesContainer">
                    <!-- Subordinate offices will be loaded here dynamically -->
                </div>
            </div>

            <!-- Other Offices Content -->
            <div id="otherOfficesContent" class="tab-pane hidden fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="otherOfficesContainer">
                    <!-- Other offices will be loaded here dynamically -->
                </div>
            </div>

            <!-- All Contacts Content -->
            <div id="allContactsContent" class="tab-pane hidden fade-in">
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="bg-gray-800 text-white px-4 py-3">
                        <h3 class="font-bold text-lg">All Contacts</h3>
                    </div>
                    <div class="p-4">
                        <div class="mb-4">
                            <div class="flex flex-wrap items-center justify-between mb-4">
                                <div class="w-full md:w-auto mb-2 md:mb-0">
                                    <label for="contactFilter" class="block text-sm font-medium text-gray-700 mb-1">Filter by:</label>
                                    <select id="contactFilter" class="w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <option value="all">All Contacts</option>
                                        <option value="senior">Senior Officers</option>
                                        <option value="investigation">Investigation Team</option>
                                        <option value="traffic">Traffic Police</option>
                                        <option value="support">Support Staff</option>
                                    </select>
                                </div>
                                <div class="w-full md:w-auto">
                                    <label for="contactSort" class="block text-sm font-medium text-gray-700 mb-1">Sort by:</label>
                                    <select id="contactSort" class="w-full md:w-48 px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <option value="name-asc">Name (A-Z)</option>
                                        <option value="name-desc">Name (Z-A)</option>
                                        <option value="designation-asc">Designation (A-Z)</option>
                                        <option value="designation-desc">Designation (Z-A)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="allContactsList" class="space-y-4">
                            <!-- Contacts will be loaded here dynamically -->
                        </div>
                        <div class="mt-4 flex justify-between items-center">
                            <div class="text-sm text-gray-600">
                                Showing <span id="contactStart">1</span>-<span id="contactEnd">10</span> of <span id="contactTotal">50</span>
                            </div>
                            <div class="flex space-x-2">
                                <button id="prevPage" class="px-3 py-1 border border-gray-300 rounded bg-white text-gray-700 disabled:opacity-50" disabled>
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button id="nextPage" class="px-3 py-1 border border-gray-300 rounded bg-white text-gray-700">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section/Office Details Content (hidden by default) -->
            <div id="detailsContent" class="hidden fade-in">
                <div class="bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="flex items-center justify-between bg-blue-800 text-white px-4 py-3">
                        <h3 id="detailsTitle" class="font-bold text-lg"></h3>
                        <button id="backButton" class="px-3 py-1 bg-blue-700 hover:bg-blue-600 rounded flex items-center">
                            <i class="fas fa-arrow-left mr-2"></i> Back
                        </button>
                    </div>
                    <div class="p-4">
                        <div class="mb-6">
                            <div class="flex flex-wrap items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-gray-800">Contact List</h4>
                                <div class="relative w-full md:w-64 mt-2 md:mt-0">
                                    <input type="text" id="sectionSearch" placeholder="Search in this section..." 
                                           class="w-full px-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <button class="absolute right-3 top-2 text-gray-500">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="contactsTable" class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer sort-header" data-sort="designation">
                                                <div class="flex items-center">
                                                    Designation
                                                    <i class="fas fa-sort ml-1 sort-icon"></i>
                                                </div>
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer sort-header" data-sort="name">
                                                <div class="flex items-center">
                                                    Name
                                                    <i class="fas fa-sort ml-1 sort-icon"></i>
                                                </div>
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Category
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Contact
                                            </th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                Actions
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody id="contactsList" class="bg-white divide-y divide-gray-200">
                                        <!-- Contacts will be loaded here dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Contact Detail Modal -->
    <div id="contactModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                <div class="bg-blue-800 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="closeModal" class="mt-0 w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-700 text-base font-medium text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        Close
                    </button>
                    <h3 class="text-lg leading-6 font-medium text-white" id="modalTitle">Contact Details</h3>
                </div>
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                    <div class="sm:flex sm:items-start">
                        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-16 w-16 rounded-full bg-blue-100 sm:mx-0 sm:h-20 sm:w-20">
                            <i class="fas fa-user-tie text-blue-600 text-2xl"></i>
                        </div>
                        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500">Designation</p>
                                    <p id="modalDesignation" class="text-lg font-medium text-gray-900"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Name</p>
                                    <p id="modalName" class="text-lg font-medium text-gray-900"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Category</p>
                                    <p id="modalCategory" class="text-gray-700"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Sub-Category</p>
                                    <p id="modalSubCategory" class="text-gray-700"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Primary Contact</p>
                                    <p id="modalContact1" class="text-gray-700"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Secondary Contact</p>
                                    <p id="modalContact2" class="text-gray-700"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Email</p>
                                    <p id="modalEmail" class="text-gray-700"></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Additional Details</p>
                                    <p id="modalDetails" class="text-gray-700"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="button" id="callPrimary" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-green-600 text-base font-medium text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-phone mr-2"></i> Call Primary
                    </button>
                    <button type="button" id="callSecondary" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-phone-alt mr-2"></i> Call Secondary
                    </button>
                    <button type="button" id="emailContact" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm">
                        <i class="fas fa-envelope mr-2"></i> Email
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">District Police Range Kathmandu</h3>
                    <p class="text-gray-400">Serving the community with dedication and professionalism.</p>
                    <div class="mt-4 flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Emergency Numbers</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Crime Reporting</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Traffic Updates</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Recruitment</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Contact Information</h3>
                    <address class="text-gray-400 not-italic">
                        <p><i class="fas fa-map-marker-alt mr-2"></i> Police Headquarters, Kathmandu</p>
                        <p class="mt-2"><i class="fas fa-phone mr-2"></i> Emergency: 100</p>
                        <p class="mt-2"><i class="fas fa-envelope mr-2"></i> info@kathmandupolice.gov.np</p>
                    </address>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-6 text-center text-gray-400">
                <p>&copy; 2023 District Police Range Kathmandu. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Data Storage (All contacts in one place for easy editing) -->
    <script id="contactsData" type="application/json">
        {
            "structure": {
                "floors": [
                    {
                        "id": "floor1",
                        "name": "Floor 1",
                        "color": "bg-blue-800",
                        "sections": [
                            {
                                "id": "floor1-admin",
                                "name": "Administration Section",
                                "contacts": [
                                    {
                                        "designation": "Chief of Administration",
                                        "name": "Aakash Sharma",
                                        "category": "Administration",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9841123456",
                                        "contact2": "01-4223344",
                                        "email": "aakash.sharma@kathmandupolice.gov.np",
                                        "details": "Office hours: 9AM-5PM, Sunday-Friday"
                                    },
                                    {
                                        "designation": "Deputy Chief",
                                        "name": "Bimala Thapa",
                                        "category": "Administration",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9851234567",
                                        "contact2": "01-4223345",
                                        "email": "bimala.thapa@kathmandupolice.gov.np",
                                        "details": "In charge of personnel management"
                                    },
                                    {
                                        "designation": "Administrative Officer",
                                        "name": "Chandra Bahadur Rai",
                                        "category": "Administration",
                                        "subCategory": "Officer",
                                        "contact1": "9861345678",
                                        "contact2": "01-4223346",
                                        "email": "chandra.rai@kathmandupolice.gov.np",
                                        "details": "Handles daily administrative tasks"
                                    }
                                ]
                            },
                            {
                                "id": "floor1-operations",
                                "name": "Operations Section",
                                "contacts": [
                                    {
                                        "designation": "Operations Chief",
                                        "name": "Dipak Joshi",
                                        "category": "Operations",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9841234567",
                                        "contact2": "01-4223355",
                                        "email": "dipak.joshi@kathmandupolice.gov.np",
                                        "details": "24/7 emergency contact available"
                                    },
                                    {
                                        "designation": "Field Operations Officer",
                                        "name": "Esha Gurung",
                                        "category": "Operations",
                                        "subCategory": "Officer",
                                        "contact1": "9852345678",
                                        "contact2": "01-4223356",
                                        "email": "esha.gurung@kathmandupolice.gov.np",
                                        "details": "Coordinates patrol teams"
                                    },
                                    {
                                        "designation": "Dispatch Officer",
                                        "name": "Firoz Khan",
                                        "category": "Operations",
                                        "subCategory": "Officer",
                                        "contact1": "9863456789",
                                        "contact2": "01-4223357",
                                        "email": "firoz.khan@kathmandupolice.gov.np",
                                        "details": "Manages emergency response"
                                    }
                                ]
                            },
                            {
                                "id": "floor1-crime",
                                "name": "Crime Investigation",
                                "contacts": [
                                    {
                                        "designation": "Crime Investigation Chief",
                                        "name": "Gopal Shrestha",
                                        "category": "Investigation",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9842345678",
                                        "contact2": "01-4223366",
                                        "email": "gopal.shrestha@kathmandupolice.gov.np",
                                        "details": "Specialized in homicide cases"
                                    },
                                    {
                                        "designation": "Forensic Investigator",
                                        "name": "Hema Rai",
                                        "category": "Investigation",
                                        "subCategory": "Specialist",
                                        "contact1": "9853456789",
                                        "contact2": "01-4223367",
                                        "email": "hema.rai@kathmandupolice.gov.np",
                                        "details": "Forensic evidence collection"
                                    },
                                    {
                                        "designation": "Cyber Crime Investigator",
                                        "name": "Ishan Poudel",
                                        "category": "Investigation",
                                        "subCategory": "Specialist",
                                        "contact1": "9864567890",
                                        "contact2": "01-4223368",
                                        "email": "ishan.poudel@kathmandupolice.gov.np",
                                        "details": "Digital forensics expert"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "floor2",
                        "name": "Floor 2",
                        "color": "bg-blue-800",
                        "sections": [
                            {
                                "id": "floor2-traffic",
                                "name": "Traffic Police",
                                "contacts": [
                                    {
                                        "designation": "Traffic Police Chief",
                                        "name": "Jeevan Adhikari",
                                        "category": "Traffic",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9843456789",
                                        "contact2": "01-4223377",
                                        "email": "jeevan.adhikari@kathmandupolice.gov.np",
                                        "details": "Manages all traffic operations"
                                    },
                                    {
                                        "designation": "Traffic Control Officer",
                                        "name": "Kiran Basnet",
                                        "category": "Traffic",
                                        "subCategory": "Officer",
                                        "contact1": "9854567890",
                                        "contact2": "01-4223378",
                                        "email": "kiran.basnet@kathmandupolice.gov.np",
                                        "details": "Coordinates traffic signals"
                                    },
                                    {
                                        "designation": "Accident Investigator",
                                        "name": "Laxman Thapa",
                                        "category": "Traffic",
                                        "subCategory": "Officer",
                                        "contact1": "9865678901",
                                        "contact2": "01-4223379",
                                        "email": "laxman.thapa@kathmandupolice.gov.np",
                                        "details": "Road accident specialist"
                                    }
                                ]
                            },
                            {
                                "id": "floor2-cyber",
                                "name": "Cyber Crime",
                                "contacts": [
                                    {
                                        "designation": "Cyber Crime Chief",
                                        "name": "Manoj Neupane",
                                        "category": "Cyber Crime",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9844567890",
                                        "contact2": "01-4223388",
                                        "email": "manoj.neupane@kathmandupolice.gov.np",
                                        "details": "Leads cyber crime division"
                                    },
                                    {
                                        "designation": "Digital Forensic Expert",
                                        "name": "Nisha Shrestha",
                                        "category": "Cyber Crime",
                                        "subCategory": "Specialist",
                                        "contact1": "9855678901",
                                        "contact2": "01-4223389",
                                        "email": "nisha.shrestha@kathmandupolice.gov.np",
                                        "details": "Data recovery specialist"
                                    },
                                    {
                                        "designation": "Cyber Security Analyst",
                                        "name": "Om Prakash",
                                        "category": "Cyber Crime",
                                        "subCategory": "Specialist",
                                        "contact1": "9866789012",
                                        "contact2": "01-4223390",
                                        "email": "om.prakash@kathmandupolice.gov.np",
                                        "details": "Network security expert"
                                    }
                                ]
                            },
                            {
                                "id": "floor2-forensic",
                                "name": "Forensic Department",
                                "contacts": [
                                    {
                                        "designation": "Forensic Department Head",
                                        "name": "Prakash Yadav",
                                        "category": "Forensic",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9845678901",
                                        "contact2": "01-4223399",
                                        "email": "prakash.yadav@kathmandupolice.gov.np",
                                        "details": "Forensic science specialist"
                                    },
                                    {
                                        "designation": "Crime Scene Investigator",
                                        "name": "Rita Tamang",
                                        "category": "Forensic",
                                        "subCategory": "Officer",
                                        "contact1": "9856789012",
                                        "contact2": "01-4223400",
                                        "email": "rita.tamang@kathmandupolice.gov.np",
                                        "details": "Evidence collection expert"
                                    },
                                    {
                                        "designation": "Lab Technician",
                                        "name": "Suresh K.C.",
                                        "category": "Forensic",
                                        "subCategory": "Technician",
                                        "contact1": "9867890123",
                                        "contact2": "01-4223401",
                                        "email": "suresh.kc@kathmandupolice.gov.np",
                                        "details": "DNA analysis specialist"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "id": "floor3",
                        "name": "Floor 3",
                        "color": "bg-blue-800",
                        "sections": [
                            {
                                "id": "floor3-hr",
                                "name": "Human Resources",
                                "contacts": [
                                    {
                                        "designation": "HR Director",
                                        "name": "Tara Devi",
                                        "category": "Human Resources",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9846789012",
                                        "contact2": "01-4223411",
                                        "email": "tara.devi@kathmandupolice.gov.np",
                                        "details": "Manages all HR operations"
                                    },
                                    {
                                        "designation": "Recruitment Officer",
                                        "name": "Umesh Bhattarai",
                                        "category": "Human Resources",
                                        "subCategory": "Officer",
                                        "contact1": "9857890123",
                                        "contact2": "01-4223412",
                                        "email": "umesh.bhattarai@kathmandupolice.gov.np",
                                        "details": "Handles police recruitment"
                                    },
                                    {
                                        "designation": "Training Coordinator",
                                        "name": "Vijaya Shrestha",
                                        "category": "Human Resources",
                                        "subCategory": "Officer",
                                        "contact1": "9868901234",
                                        "contact2": "01-4223413",
                                        "email": "vijaya.shrestha@kathmandupolice.gov.np",
                                        "details": "Coordinates training programs"
                                    }
                                ]
                            },
                            {
                                "id": "floor3-training",
                                "name": "Training Section",
                                "contacts": [
                                    {
                                        "designation": "Training Director",
                                        "name": "Yogesh Karki",
                                        "category": "Training",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9847890123",
                                        "contact2": "01-4223422",
                                        "email": "yogesh.karki@kathmandupolice.gov.np",
                                        "details": "Oversees all training programs"
                                    },
                                    {
                                        "designation": "Physical Training Instructor",
                                        "name": "Zahir Alam",
                                        "category": "Training",
                                        "subCategory": "Instructor",
                                        "contact1": "9858901234",
                                        "contact2": "01-4223423",
                                        "email": "zahir.alam@kathmandupolice.gov.np",
                                        "details": "Self-defense and fitness training"
                                    },
                                    {
                                        "designation": "Classroom Instructor",
                                        "name": "Anita Thapa",
                                        "category": "Training",
                                        "subCategory": "Instructor",
                                        "contact1": "9869012345",
                                        "contact2": "01-4223424",
                                        "email": "anita.thapa@kathmandupolice.gov.np",
                                        "details": "Law and procedure training"
                                    }
                                ]
                            },
                            {
                                "id": "floor3-welfare",
                                "name": "Welfare Section",
                                "contacts": [
                                    {
                                        "designation": "Welfare Officer",
                                        "name": "Bikram Rana",
                                        "category": "Welfare",
                                        "subCategory": "Senior Officer",
                                        "contact1": "9848901234",
                                        "contact2": "01-4223433",
                                        "email": "bikram.rana@kathmandupolice.gov.np",
                                        "details": "Officer welfare programs"
                                    },
                                    {
                                        "designation": "Counselor",
                                        "name": "Chhaya Gurung",
                                        "category": "Welfare",
                                        "subCategory": "Officer",
                                        "contact1": "9859012345",
                                        "contact2": "01-4223434",
                                        "email": "chhaya.gurung@kathmandupolice.gov.np",
                                        "details": "Psychological counseling"
                                    },
                                    {
                                        "designation": "Medical Officer",
                                        "name": "Deepak Shrestha",
                                        "category": "Welfare",
                                        "subCategory": "Officer",
                                        "contact1": "9860123456",
                                        "contact2": "01-4223435",
                                        "email": "deepak.shrestha@kathmandupolice.gov.np",
                                        "details": "Health and medical services"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "subOffices": [
                    {
                        "id": "area1",
                        "name": "Area Police Office - Kathmandu Central",
                        "color": "bg-green-700",
                        "contacts": [
                            {
                                "designation": "Area Police Chief",
                                "name": "Rajesh Hamal",
                                "category": "Area Office",
                                "subCategory": "Senior Officer",
                                "contact1": "9849012345",
                                "contact2": "01-4223444",
                                "email": "rajesh.hamal@kathmandupolice.gov.np",
                                "details": "Kathmandu Central Area"
                            },
                            {
                                "designation": "Deputy Area Chief",
                                "name": "Sita Poudel",
                                "category": "Area Office",
                                "subCategory": "Officer",
                                "contact1": "9850123456",
                                "contact2": "01-4223445",
                                "email": "sita.poudel@kathmandupolice.gov.np",
                                "details": "Night shift supervisor"
                            },
                            {
                                "designation": "Patrol Officer",
                                "name": "Hari Bahadur",
                                "category": "Area Office",
                                "subCategory": "Officer",
                                "contact1": "9861234567",
                                "contact2": "01-4223446",
                                "email": "hari.bahadur@kathmandupolice.gov.np",
                                "details": "Field operations"
                            }
                        ]
                    },
                    {
                        "id": "area2",
                        "name": "Area Police Office - Kathmandu East",
                        "color": "bg-green-700",
                        "contacts": [
                            {
                                "designation": "Area Police Chief",
                                "name": "Gopal Pandey",
                                "category": "Area Office",
                                "subCategory": "Senior Officer",
                                "contact1": "9840123456",
                                "contact2": "01-4223455",
                                "email": "gopal.pandey@kathmandupolice.gov.np",
                                "details": "Kathmandu East Area"
                            },
                            {
                                "designation": "Community Liaison",
                                "name": "Indira K.C.",
                                "category": "Area Office",
                                "subCategory": "Officer",
                                "contact1": "9851234567",
                                "contact2": "01-4223456",
                                "email": "indira.kc@kathmandupolice.gov.np",
                                "details": "Community relations"
                            },
                            {
                                "designation": "Traffic Coordinator",
                                "name": "Jitendra Thapa",
                                "category": "Area Office",
                                "subCategory": "Officer",
                                "contact1": "9862345678",
                                "contact2": "01-4223457",
                                "email": "jitendra.thapa@kathmandupolice.gov.np",
                                "details": "Local traffic management"
                            }
                        ]
                    },
                    {
                        "id": "post1",
                        "name": "Police Post - New Road",
                        "color": "bg-green-700",
                        "contacts": [
                            {
                                "designation": "Post In-Charge",
                                "name": "Krishna Shrestha",
                                "category": "Police Post",
                                "subCategory": "Officer",
                                "contact1": "9841234567",
                                "contact2": "01-4223466",
                                "email": "krishna.shrestha@kathmandupolice.gov.np",
                                "details": "New Road Police Post"
                            },
                            {
                                "designation": "Assistant Officer",
                                "name": "Laxmi Gurung",
                                "category": "Police Post",
                                "subCategory": "Officer",
                                "contact1": "9852345678",
                                "contact2": "01-4223467",
                                "email": "laxmi.gurung@kathmandupolice.gov.np",
                                "details": "Day shift"
                            },
                            {
                                "designation": "Patrol Officer",
                                "name": "Mohan Rai",
                                "category": "Police Post",
                                "subCategory": "Officer",
                                "contact1": "9863456789",
                                "contact2": "01-4223468",
                                "email": "mohan.rai@kathmandupolice.gov.np",
                                "details": "Night patrol"
                            }
                        ]
                    }
                ],
                "otherOffices": [
                    {
                        "id": "special1",
                        "name": "SWAT Team",
                        "color": "bg-purple-700",
                        "contacts": [
                            {
                                "designation": "SWAT Team Leader",
                                "name": "Niraj Basnet",
                                "category": "Special Unit",
                                "subCategory": "Senior Officer",
                                "contact1": "9842345678",
                                "contact2": "01-4223477",
                                "email": "niraj.basnet@kathmandupolice.gov.np",
                                "details": "24/7 emergency response"
                            },
                            {
                                "designation": "Tactical Officer",
                                "name": "Ojaswi Thapa",
                                "category": "Special Unit",
                                "subCategory": "Officer",
                                "contact1": "9853456789",
                                "contact2": "01-4223478",
                                "email": "ojaswi.thapa@kathmandupolice.gov.np",
                                "details": "Weapons specialist"
                            },
                            {
                                "designation": "Negotiator",
                                "name": "Prabin Shrestha",
                                "category": "Special Unit",
                                "subCategory": "Officer",
                                "contact1": "9864567890",
                                "contact2": "01-4223479",
                                "email": "prabin.shrestha@kathmandupolice.gov.np",
                                "details": "Hostage situations"
                            }
                        ]
                    },
                    {
                        "id": "support1",
                        "name": "Police Hospital",
                        "color": "bg-purple-700",
                        "contacts": [
                            {
                                "designation": "Chief Medical Officer",
                                "name": "Ramesh K.C.",
                                "category": "Support Service",
                                "subCategory": "Senior Officer",
                                "contact1": "9843456789",
                                "contact2": "01-4223488",
                                "email": "ramesh.kc@kathmandupolice.gov.np",
                                "details": "Police Hospital"
                            },
                            {
                                "designation": "Emergency Doctor",
                                "name": "Sabina Rai",
                                "category": "Support Service",
                                "subCategory": "Officer",
                                "contact1": "9854567890",
                                "contact2": "01-4223489",
                                "email": "sabina.rai@kathmandupolice.gov.np",
                                "details": "24/7 emergency service"
                            },
                            {
                                "designation": "Nurse In-Charge",
                                "name": "Tika Gurung",
                                "category": "Support Service",
                                "subCategory": "Officer",
                                "contact1": "9865678901",
                                "contact2": "01-4223490",
                                "email": "tika.gurung@kathmandupolice.gov.np",
                                "details": "Patient care coordinator"
                            }
                        ]
                    },
                    {
                        "id": "community1",
                        "name": "Community Police Service Center",
                        "color": "bg-purple-700",
                        "contacts": [
                            {
                                "designation": "Community Service Chief",
                                "name": "Ujjwal Adhikari",
                                "category": "Community Service",
                                "subCategory": "Senior Officer",
                                "contact1": "9844567890",
                                "contact2": "01-4223499",
                                "email": "ujjwal.adhikari@kathmandupolice.gov.np",
                                "details": "Community outreach programs"
                            },
                            {
                                "designation": "Women's Safety Officer",
                                "name": "Vidya Bhandari",
                                "category": "Community Service",
                                "subCategory": "Officer",
                                "contact1": "9855678901",
                                "contact2": "01-4223500",
                                "email": "vidya.bhandari@kathmandupolice.gov.np",
                                "details": "Women's safety initiatives"
                            },
                            {
                                "designation": "Youth Coordinator",
                                "name": "Wasim Khan",
                                "category": "Community Service",
                                "subCategory": "Officer",
                                "contact1": "9866789012",
                                "contact2": "01-4223501",
                                "email": "wasim.khan@kathmandupolice.gov.np",
                                "details": "School programs"
                            }
                        ]
                    }
                ]
            }
        }
    </script>

    <script>
        // Parse the data from the script tag
        const data = JSON.parse(document.getElementById('contactsData').textContent);
        
        // Combine all contacts for "All Contacts" tab
        const allContacts = [];
        
        // Extract all contacts from the structure
        function extractContacts(structure) {
            const contacts = [];
            
            // Floors and sections
            structure.floors.forEach(floor => {
                floor.sections.forEach(section => {
                    contacts.push(...section.contacts);
                });
            });
            
            // Subordinate offices
            structure.subOffices.forEach(office => {
                contacts.push(...office.contacts);
            });
            
            // Other offices
            structure.otherOffices.forEach(office => {
                contacts.push(...office.contacts);
            });
            
            return contacts;
        }
        
        allContacts.push(...extractContacts(data.structure));

        // Current state
        let currentTab = 'floors';
        let currentSection = '';
        let currentContacts = [];
        let currentSort = { field: 'name', direction: 'asc' };
        let currentPage = 1;
        const contactsPerPage = 10;
        let currentSearchTerm = '';
        let currentFilter = 'all';

        // DOM Elements
        const tabButtons = {
            floors: document.getElementById('floorsTab'),
            subOffices: document.getElementById('subOfficesTab'),
            otherOffices: document.getElementById('otherOfficesTab'),
            allContacts: document.getElementById('allContactsTab')
        };

        const tabContents = {
            floors: document.getElementById('floorsContent'),
            subOffices: document.getElementById('subOfficesContent'),
            otherOffices: document.getElementById('otherOfficesContent'),
            allContacts: document.getElementById('allContactsContent'),
            details: document.getElementById('detailsContent')
        };

        const floorsContainer = document.getElementById('floorsContainer');
        const subOfficesContainer = document.getElementById('subOfficesContainer');
        const otherOfficesContainer = document.getElementById('otherOfficesContainer');
        const backButton = document.getElementById('backButton');
        const detailsTitle = document.getElementById('detailsTitle');
        const contactsList = document.getElementById('contactsList');
        const allContactsList = document.getElementById('allContactsList');
        const globalSearch = document.getElementById('globalSearch');
        const sectionSearch = document.getElementById('sectionSearch');
        const contactFilter = document.getElementById('contactFilter');
        const contactSort = document.getElementById('contactSort');
        const prevPage = document.getElementById('prevPage');
        const nextPage = document.getElementById('nextPage');
        const contactStart = document.getElementById('contactStart');
        const contactEnd = document.getElementById('contactEnd');
        const contactTotal = document.getElementById('contactTotal');

        // Modal elements
        const contactModal = document.getElementById('contactModal');
        const closeModal = document.getElementById('closeModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDesignation = document.getElementById('modalDesignation');
        const modalName = document.getElementById('modalName');
        const modalCategory = document.getElementById('modalCategory');
        const modalSubCategory = document.getElementById('modalSubCategory');
        const modalContact1 = document.getElementById('modalContact1');
        const modalContact2 = document.getElementById('modalContact2');
        const modalEmail = document.getElementById('modalEmail');
        const modalDetails = document.getElementById('modalDetails');
        const callPrimary = document.getElementById('callPrimary');
        const callSecondary = document.getElementById('callSecondary');
        const emailContact = document.getElementById('emailContact');

        // Event Listeners
        // Tab switching
        tabButtons.floors.addEventListener('click', () => switchTab('floors'));
        tabButtons.subOffices.addEventListener('click', () => switchTab('subOffices'));
        tabButtons.otherOffices.addEventListener('click', () => switchTab('otherOffices'));
        tabButtons.allContacts.addEventListener('click', () => switchTab('allContacts'));

        // Back button
        backButton.addEventListener('click', () => {
            tabContents.details.classList.add('hidden');
            tabContents[currentTab].classList.remove('hidden');
        });

        // Global search
        globalSearch.addEventListener('input', (e) => {
            currentSearchTerm = e.target.value.toLowerCase();
            if (currentTab === 'allContacts') {
                renderAllContacts();
            } else if (currentTab === 'details') {
                renderSectionContacts();
            }
        });

        // Section search
        sectionSearch.addEventListener('input', (e) => {
            currentSearchTerm = e.target.value.toLowerCase();
            renderSectionContacts();
        });

        // Contact filter
        contactFilter.addEventListener('change', (e) => {
            currentFilter = e.target.value;
            currentPage = 1;
            renderAllContacts();
        });

        // Contact sort
        contactSort.addEventListener('change', (e) => {
            const [field, direction] = e.target.value.split('-');
            currentSort = { field, direction };
            renderAllContacts();
        });

        // Pagination
        prevPage.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderAllContacts();
            }
        });

        nextPage.addEventListener('click', () => {
            const totalPages = Math.ceil(filterAndSortContacts(allContacts).length / contactsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderAllContacts();
            }
        });

        // Sort headers in section details
        document.querySelectorAll('.sort-header').forEach(header => {
            header.addEventListener('click', () => {
                const field = header.dataset.sort;
                // Toggle direction if clicking the same field
                if (currentSort.field === field) {
                    currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.field = field;
                    currentSort.direction = 'asc';
                }
                
                // Update sort indicators
                document.querySelectorAll('.sort-header').forEach(h => {
                    h.classList.remove('sort-asc', 'sort-desc');
                });
                
                header.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                
                renderSectionContacts();
            });
        });

        // Modal events
        closeModal.addEventListener('click', () => {
            contactModal.classList.add('hidden');
        });

        // Functions
        function switchTab(tab) {
            // Hide all tab contents
            Object.values(tabContents).forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected tab content
            tabContents[tab].classList.remove('hidden');
            
            // Update tab button styles
            Object.values(tabButtons).forEach(button => {
                button.classList.remove('active', 'text-blue-700', 'border-blue-700');
                button.classList.add('text-gray-600', 'hover:text-blue-700');
            });
            
            tabButtons[tab].classList.add('active', 'text-blue-700', 'border-blue-700');
            tabButtons[tab].classList.remove('text-gray-600', 'hover:text-blue-700');
            
            // Update current tab
            currentTab = tab;
            
            // Reset search term when switching tabs
            currentSearchTerm = '';
            globalSearch.value = '';
            
            // Special handling for all contacts tab
            if (tab === 'allContacts') {
                currentPage = 1;
                renderAllContacts();
            }
        }

        function renderFloors() {
            floorsContainer.innerHTML = '';
            
            data.structure.floors.forEach(floor => {
                const floorCard = document.createElement('div');
                floorCard.className = 'bg-white rounded-lg shadow-md overflow-hidden card-hover';
                
                floorCard.innerHTML = `
                    <div class="${floor.color} text-white px-4 py-3">
                        <h3 class="font-bold text-lg">${floor.name}</h3>
                    </div>
                    <div class="p-4">
                        <div class="mb-4">
                            <h4 class="font-semibold text-gray-700 mb-2 flex items-center">
                                <i class="fas fa-building mr-2 text-blue-600"></i> Sections
                            </h4>
                            <ul class="space-y-2" id="sections-${floor.id}">
                                <!-- Sections will be added here -->
                            </ul>
                        </div>
                    </div>
                `;
                
                floorsContainer.appendChild(floorCard);
                
                const sectionsList = document.getElementById(`sections-${floor.id}`);
                
                floor.sections.forEach(section => {
                    const sectionItem = document.createElement('li');
                    sectionItem.innerHTML = `
                        <button class="section-btn w-full text-left px-3 py-2 bg-gray-100 hover:bg-blue-50 rounded flex justify-between items-center" data-section="${section.id}">
                            <span>${section.name}</span>
                            <i class="fas fa-chevron-right text-sm text-gray-500"></i>
                        </button>
                    `;
                    
                    sectionsList.appendChild(sectionItem);
                    
                    // Add event listener to section button
                    sectionItem.querySelector('.section-btn').addEventListener('click', () => {
                        showSectionDetails(section.id);
                    });
                });
            });
        }

        function renderSubOffices() {
            subOfficesContainer.innerHTML = '';
            
            data.structure.subOffices.forEach(office => {
                const officeCard = document.createElement('div');
                officeCard.className = 'bg-white rounded-lg shadow-md overflow-hidden card-hover';
                
                officeCard.innerHTML = `
                    <div class="${office.color} text-white px-4 py-3">
                        <h3 class="font-bold text-lg">${office.name}</h3>
                    </div>
                    <div class="p-4">
                        <button class="office-btn w-full text-left px-3 py-2 bg-gray-100 hover:bg-green-50 rounded flex justify-between items-center" data-office="${office.id}">
                            <span>View Contacts</span>
                            <i class="fas fa-chevron-right text-sm text-gray-500"></i>
                        </button>
                    </div>
                `;
                
                subOfficesContainer.appendChild(officeCard);
                
                // Add event listener to office button
                officeCard.querySelector('.office-btn').addEventListener('click', () => {
                    showSectionDetails(office.id);
                });
            });
        }

        function renderOtherOffices() {
            otherOfficesContainer.innerHTML = '';
            
            data.structure.otherOffices.forEach(office => {
                const officeCard = document.createElement('div');
                officeCard.className = 'bg-white rounded-lg shadow-md overflow-hidden card-hover';
                
                officeCard.innerHTML = `
                    <div class="${office.color} text-white px-4 py-3">
                        <h3 class="font-bold text-lg">${office.name}</h3>
                    </div>
                    <div class="p-4">
                        <button class="office-btn w-full text-left px-3 py-2 bg-gray-100 hover:bg-purple-50 rounded flex justify-between items-center" data-office="${office.id}">
                            <span>View Contacts</span>
                            <i class="fas fa-chevron-right text-sm text-gray-500"></i>
                        </button>
                    </div>
                `;
                
                otherOfficesContainer.appendChild(officeCard);
                
                // Add event listener to office button
                officeCard.querySelector('.office-btn').addEventListener('click', () => {
                    showSectionDetails(office.id);
                });
            });
        }

        function showSectionDetails(sectionId) {
            // Hide current tab content and show details content
            tabContents[currentTab].classList.add('hidden');
            tabContents.details.classList.remove('hidden');
            
            // Find the section/office in our data structure
            let sectionData = null;
            let sectionName = '';
            
            // Check floors and sections
            for (const floor of data.structure.floors) {
                const section = floor.sections.find(s => s.id === sectionId);
                if (section) {
                    sectionData = section;
                    sectionName = `${floor.name} - ${section.name}`;
                    break;
                }
            }
            
            // Check subordinate offices
            if (!sectionData) {
                const office = data.structure.subOffices.find(o => o.id === sectionId);
                if (office) {
                    sectionData = office;
                    sectionName = office.name;
                }
            }
            
            // Check other offices
            if (!sectionData) {
                const office = data.structure.otherOffices.find(o => o.id === sectionId);
                if (office) {
                    sectionData = office;
                    sectionName = office.name;
                }
            }
            
            if (!sectionData) return;
            
            // Set the section title
            detailsTitle.textContent = sectionName;
            
            // Store current section and load contacts
            currentSection = sectionId;
            currentContacts = sectionData.contacts || [];
            currentSearchTerm = '';
            sectionSearch.value = '';
            
            // Reset sort
            currentSort = { field: 'name', direction: 'asc' };
            document.querySelectorAll('.sort-header').forEach(h => {
                h.classList.remove('sort-asc', 'sort-desc');
            });
            
            renderSectionContacts();
        }

        function renderSectionContacts() {
            if (!currentContacts) return;
            
            // Filter contacts based on search term
            let filteredContacts = currentContacts.filter(contact => {
                const searchFields = [
                    contact.designation.toLowerCase(),
                    contact.name.toLowerCase(),
                    contact.category.toLowerCase(),
                    contact.subCategory.toLowerCase(),
                    contact.contact1,
                    contact.contact2,
                    contact.email.toLowerCase(),
                    contact.details.toLowerCase()
                ];
                
                return searchFields.some(field => field.includes(currentSearchTerm));
            });
            
            // Sort contacts
            filteredContacts.sort((a, b) => {
                const fieldA = a[currentSort.field]?.toLowerCase() || '';
                const fieldB = b[currentSort.field]?.toLowerCase() || '';
                
                if (currentSort.direction === 'asc') {
                    return fieldA.localeCompare(fieldB);
                } else {
                    return fieldB.localeCompare(fieldA);
                }
            });
            
            // Clear current contacts
            contactsList.innerHTML = '';
            
            // Add filtered and sorted contacts
            filteredContacts.forEach(contact => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                // Highlight search term in text
                const highlightText = (text) => {
                    if (!currentSearchTerm) return text;
                    const regex = new RegExp(currentSearchTerm, 'gi');
                    return text.replace(regex, match => `<span class="search-highlight">${match}</span>`);
                };
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${highlightText(contact.designation)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${highlightText(contact.name)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-500">${highlightText(contact.category)}</div>
                        <div class="text-xs text-gray-400">${highlightText(contact.subCategory)}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">${highlightText(contact.contact1)}</div>
                        ${contact.contact2 ? `<div class="text-xs text-gray-500">${highlightText(contact.contact2)}</div>` : ''}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="view-details text-blue-600 hover:text-blue-900 mr-3" data-contact='${JSON.stringify(contact).replace(/'/g, "\\'")}'>
                            <i class="fas fa-eye mr-1"></i> View
                        </button>
                        <a href="tel:${contact.contact1}" class="text-green-600 hover:text-green-900">
                            <i class="fas fa-phone mr-1"></i> Call
                        </a>
                    </td>
                `;
                
                contactsList.appendChild(row);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', (e) => {
                    const contact = JSON.parse(button.dataset.contact);
                    showContactModal(contact);
                });
            });
        }

        function filterAndSortContacts(contacts) {
            // Filter contacts based on search term and filter
            let filteredContacts = contacts.filter(contact => {
                // Apply category filter
                let matchesFilter = true;
                if (currentFilter !== 'all') {
                    matchesFilter = contact.category.toLowerCase().includes(currentFilter) || 
                                   contact.subCategory.toLowerCase().includes(currentFilter);
                }
                
                if (!matchesFilter) return false;
                
                // Apply search term
                if (!currentSearchTerm) return true;
                
                const searchFields = [
                    contact.designation.toLowerCase(),
                    contact.name.toLowerCase(),
                    contact.category.toLowerCase(),
                    contact.subCategory.toLowerCase(),
                    contact.contact1,
                    contact.contact2,
                    contact.email.toLowerCase(),
                    contact.details.toLowerCase()
                ];
                
                return searchFields.some(field => field.includes(currentSearchTerm));
            });
            
            // Sort contacts
            filteredContacts.sort((a, b) => {
                const fieldA = a[currentSort.field]?.toLowerCase() || '';
                const fieldB = b[currentSort.field]?.toLowerCase() || '';
                
                if (currentSort.direction === 'asc') {
                    return fieldA.localeCompare(fieldB);
                } else {
                    return fieldB.localeCompare(fieldA);
                }
            });
            
            return filteredContacts;
        }

        function renderAllContacts() {
            const filteredContacts = filterAndSortContacts(allContacts);
            const totalContacts = filteredContacts.length;
            const totalPages = Math.ceil(totalContacts / contactsPerPage);
            
            // Update pagination info
            contactTotal.textContent = totalContacts;
            contactStart.textContent = ((currentPage - 1) * contactsPerPage) + 1;
            contactEnd.textContent = Math.min(currentPage * contactsPerPage, totalContacts);
            
            // Enable/disable pagination buttons
            prevPage.disabled = currentPage <= 1;
            nextPage.disabled = currentPage >= totalPages;
            
            // Get contacts for current page
            const startIndex = (currentPage - 1) * contactsPerPage;
            const endIndex = Math.min(startIndex + contactsPerPage, totalContacts);
            const pageContacts = filteredContacts.slice(startIndex, endIndex);
            
            // Clear current contacts
            allContactsList.innerHTML = '';
            
            // Add contacts for current page
            pageContacts.forEach(contact => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-lg shadow p-6 hover:shadow-md transition-shadow duration-200';
                
                // Highlight search term in text
                const highlightText = (text) => {
                    if (!currentSearchTerm) return text;
                    const regex = new RegExp(currentSearchTerm, 'gi');
                    return text.replace(regex, match => `<span class="search-highlight">${match}</span>`);
                };
                
                card.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 h-12 w-12 rounded-full bg-blue-100 flex items-center justify-center">
                            <i class="fas fa-user-tie text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg font-medium text-gray-900">${highlightText(contact.name)}</h3>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    ${highlightText(contact.category)}
                                </span>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">${highlightText(contact.designation)}</p>
                            <div class="mt-2 flex flex-wrap gap-2">
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                    <i class="fas fa-phone-alt mr-1 text-gray-500"></i> ${highlightText(contact.contact1)}
                                </span>
                                ${contact.contact2 ? `
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800">
                                    <i class="fas fa-phone mr-1 text-gray-500"></i> ${highlightText(contact.contact2)}
                                </span>
                                ` : ''}
                            </div>
                            <div class="mt-3 flex space-x-3">
                                <button class="view-details inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-contact='${JSON.stringify(contact).replace(/'/g, "\\'")}'>
                                    <i class="fas fa-eye mr-1"></i> Details
                                </button>
                                <a href="tel:${contact.contact1}" class="inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    <i class="fas fa-phone mr-1"></i> Call
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                
                allContactsList.appendChild(card);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', (e) => {
                    const contact = JSON.parse(button.dataset.contact);
                    showContactModal(contact);
                });
            });
        }

        function showContactModal(contact) {
            // Set modal content
            modalTitle.textContent = `${contact.designation} - ${contact.name}`;
            modalDesignation.textContent = contact.designation;
            modalName.textContent = contact.name;
            modalCategory.textContent = contact.category;
            modalSubCategory.textContent = contact.subCategory;
            modalContact1.textContent = contact.contact1;
            modalContact2.textContent = contact.contact2 || 'N/A';
            modalEmail.textContent = contact.email;
            modalDetails.textContent = contact.details || 'No additional details';
            
            // Set up action buttons
            callPrimary.onclick = () => { window.location.href = `tel:${contact.contact1}`; };
            callSecondary.onclick = () => { 
                if (contact.contact2) window.location.href = `tel:${contact.contact2}`; 
            };
            emailContact.onclick = () => { window.location.href = `mailto:${contact.email}`; };
            
            // Show modal
            contactModal.classList.remove('hidden');
        }

        // Initialize
        renderFloors();
        renderSubOffices();
        renderOtherOffices();
        renderAllContacts();
    </script>
</body>
</html>
